name: Deploy Resource Group

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment (dev/uat/test/prd)'
        required: true
        type: choice
        options: 
          - dev
          - uat
          - test
          - prd
        default: dev

jobs:
  validate-branch:
    uses: ./.github/workflows/validate-branch.yml
    with:
      environment: ${{ github.event.inputs.environment }}

  deploy-resource-group:
    needs: validate-branch
    uses: ./.github/workflows/bicep-deploy.yml
    with:
      environment: ${{ github.event.inputs.environment }}
      bicep_file: 'infra/resource-group-creation/resource-group.bicep'
      parameters_file: 'infra/resource-group-creation/resource-group-${{ github.event.inputs.environment }}.parameters.json'
      deployment_scope: 'sub'
      deployment_location: 'westus2'
      output_query: 'properties.outputs.resourceGroupName.value'
    secrets:
      azure_credentials: ${{ github.event.inputs.environment == 'dev' && secrets.AZURE_CREDENTIALS_DEV || github.event.inputs.environment == 'uat' && secrets.AZURE_CREDENTIALS_UAT || github.event.inputs.environment == 'test' && secrets.AZURE_CREDENTIALS_TEST || secrets.AZURE_CREDENTIALS_PRD }}
      resource_group_name: ''
